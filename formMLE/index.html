<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário MLE - Mandado de Levantamento Eletrônico</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }

        .container {
            width: 186mm;
            max-width: 186mm;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 15mm;
        }

        .header {
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .header span {
            font-weight: normal;
        }

        .section {
            margin-bottom: 20px;
        }

        .inline-section {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .inline-section.smaller-margin {
            margin-bottom: 10px;
        }

        .inline-section.print-smaller-margin {
            margin-bottom: 1px;
        }

        .inline-section label {
            width: 150px;
            /* Ajuste conforme necessário */
            font-weight: bold;
            margin-right: 10px;
        }

        .inline-section .banco {
            flex: 3;
            max-width: calc(55% - 160px);
            /* Ajuste conforme necessário */
        }

        .inline-section .codigo-banco {
            flex: 1;
            max-width: 60px;
            /* Ajuste conforme necessário */
        }

        .inline-section input[type="text"],
        .inline-section input[type="number"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[type="radio"] {
            margin-right: 5px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        label {
            font-weight: bold;
        }

        label.codbanco-lab {
            margin-left: 10px;
        }

        .radio-group label {
            font-weight: normal;
        }

        .radio-group {
            margin-bottom: 10px;
        }

        .observacoes input {
            width: calc(100% - 20px);
            padding: 10px;
        }

        .no-border-on-pdf input[type="text"],
        .no-border-on-pdf input[type="number"] {
            border: none;
            /*border-bottom: 1px solid #000;*/
            background: none;
            box-shadow: none;
            padding: 5px;
        }

        .no-border-on-pdf {
            border: 2px solid #000;
            padding: 10mm 1mm 10mm 1mm;
            margin: 0;
            width: 189mm;
        }

        .hidden {
            display: none;
        }

        .copy-button {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .copy-button:hover {
            background-color: #0056b3;
        }

        @media print {
            .copy-button {
                display: none;
            }


            .container {
                box-shadow: none;
                border: none;
                width: 100%;
                margin: 0;
                padding: 0;
            }

            .header {
                font-size: 1.1em;
                border-bottom: 1px solid #000;
                margin-bottom: 15px;
            }

            .inline-section,
            .section,
            .radio-group {
                page-break-inside: avoid;
            }

            .no-border-on-pdf input[type="text"],
            .no-border-on-pdf input[type="number"] {
                border: none;
                border-bottom: 1px solid #000;
                background: none;
                box-shadow: none;
                padding: 5px;
            }

            .copy-button {
                display: none;
            }

            .declaration {
                display: block;
            }
        }

        .print-button {
            display: block;
            width: 150px;
            margin: 20px auto;
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .print-button:hover {
            background-color: #0056b3;
        }

        .declaration {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .declaration .signature-line {
            margin-top: 20px;
            border-top: 1px solid #000;
            width: 200px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <script src="https://unpkg.com/imask"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            FORMULÁRIO MLE – MANDADO DE LEVANTAMENTO ELETRÔNICO<br>
            <span>(1 Formulário para cada beneficiário)</span>
        </div>
        <div class="inline-section smaller-margin" id="processo-section">
            <label>Número do processo (padrão CNJ):</label>
            <input type="text" name="numero_processo" id="numero_processo">
        </div>
        <div class="inline-section smaller-margin" id="credor-section">
            <label>Nome do Credor (Beneficiário):</label>
            <input type="text" name="nome_credor" id="nome_credor">
        </div>
        <div class="inline-section smaller-margin" id="cpf-section">
            <label>CPF/CNPJ do Credor (Beneficiário):</label>
            <input type="text" name="cpf_cnpj_credor" id="cpf_cnpj_credor">
        </div>
        <p style="height: 2px;"></p>

        <div class="section">
            <label>Forma de recebimento:</label><br>
            <div class="radio-group">
                <input type="radio" name="forma_recebimento" value="comparecer_banco" class="radio-option"> Comparecer
                ao banco [valores até
                R$ 5.000,00 – isento de tarifa]<br>
                <input type="radio" name="forma_recebimento" value="credito_bb" class="radio-option"> Crédito em conta
                do Banco do Brasil*
                [Qualquer valor. Isento de tarifa]<br>
                <input type="radio" name="forma_recebimento" value="credito_outros" class="radio-option"> Crédito em
                conta para outros
                bancos* [Qualquer valor. Isento de tarifa]<br>
                <input type="radio" name="forma_recebimento" value="pix" class="radio-option"> IV – Pix [valores até R$
                50.000,00 – isento de
                tarifa]
            </div>
        </div>
        <div id="form-fields" class="hidden">
            <div id="hidden-fields">
                <div class="section">
                    <label>Titular da conta de destino:</label><br>
                    <div class="radio-group">
                        <input type="radio" name="titular_conta" value="parte" class="radio-option"> Parte<br>

                        <!--input type="radio" name="titular_conta" value="advogado" class="radio-option"> Advogado –
                        OAB/___ nº_____ - Procuração nas
                        fls. ____<br>
                        <input type="radio" name="titular_conta" value="procurador" class="radio-option">
                        Procurador/Representante Legal – Procuração
                        nas fls. ____<br-->
                        <input type="radio" name="titular_conta" value="terceiro" class="radio-option"
                            id="titular_terceiro"> Terceiro
                        <input type="text" id="terceiro_nome" class="hidden" placeholder="Nome do terceiro">
                    </div>
                </div>
                <div class="inline-section">
                    <label>Banco:</label>
                    <select name="banco" class="banco" id="banco_select">
                        <option value="" disabled selected>Selecione um banco</option>
                        <option value="Banco do Brasil" data-codigo="0001">Banco do Brasil</option>
                        <option value="Caixa Econômica Federal" data-codigo="0247">Caixa Econômica Federal</option>
                        <option value="Itaú Unibanco" data-codigo="0341">Itaú Unibanco</option>
                        <option value="Banco Bradesco" data-codigo="0237">Banco Bradesco</option>
                        <option value="Banco Santander" data-codigo="0333">Banco Santander</option>
                        <option value="Outro">Outro</option>
                    </select>
                    <input type="text" name="banco_outro" id="banco_outro" class="hidden"
                        placeholder="Digite o nome do banco">

                    <label class="codbanco-lab">Código do Banco:</label>
                    <input type="text" name="codigo_banco" id="codigo_banco" maxlength="4" class="codigo-banco"
                        readonly>

                </div>
                <div class="inline-section">
                    <label>Agência:</label>
                    <input type="text" name="agencia">
                </div>
                <div class="inline-section">
                    <label>Conta nº:</label>
                    <input type="text" name="conta_numero">
                </div>
                <div class="section">
                    <label>Tipo de Crédito:</label><br>
                    <div class="radio-group">
                        <input type="radio" name="tipo_credito" value="conta_corrente" class="radio-option"> Conta
                        Corrente
                        <input type="radio" name="tipo_credito" value="poupanca" class="radio-option"> Conta Poupança
                    </div>
                </div>
                <div class="inline-section">
                    <label>CPF/CNPJ do titular da conta destino:</label>
                    <input type="text" name="cpf_cnpj_titular" id="cpf_cnpj_titular">
                    <button type="button" class="copy-button" onclick="copyCpfCnpj()">Copiar</button>
                </div>
                <div class="inline-section">
                    <label>Nome do titular da conta destino:</label>
                    <input type="text" name="nome_titular" id="nome_titular">
                    <button type="button" class="copy-button" onclick="copyNome()">Copiar</button>
                </div>
            </div>
            <div id="pix-fields" class="hidden">
                <div class="inline-section">
                    <label>*Para a opção “IV –Pix”, será necessário informar a chave Pix (CPF ou CNPJ):</label>
                    <input type="text" name="chave_pix" id="chave_pix">
                    <button type="button" class="copy-button" onclick="copyCpfCnpjPix()">Copiar</button>
                </div>
                <div class="inline-section">
                    <label>Nome do titular da conta destino:</label>
                    <input type="text" name="nome_titular_pix" id="nome_titular_pix">
                    <button type="button" class="copy-button" onclick="copyNomePix()">Copiar</button>
                </div>
            </div>
        </div>
        <div class="section">
            <label>Tipo de Resgate:</label><br>
            <div class="radio-group">
                <input type="radio" name="tipo_resgate" value="parcial" class="radio-option"> Parcial
                <input type="radio" name="tipo_resgate" value="total" class="radio-option"> Total
            </div>
        </div>
        <div class="inline-section">
            <label>Nº da página do processo em que consta o comprovante do depósito:</label>
            <input type="number" name="pagina_processo">
        </div>
        <div class="inline-section">
            <label>Valor nominal do depósito:</label>
            <input type="text" name="valor_deposito">
        </div>
        <div class="section observacoes">
            <label>Observações:</label><br>
            <input type="text" name="observacoes">
        </div>
        <div class="declaration">
            <p>Declaro ser de minha responsabilidade os dados deste formulário, os quais eu conferi e revisei.</p>
            <p style="height: 5px;"></p>
            <div class="signature-line"></div>
            <p id="nome_credor_declaration"></p>


        </div>
        <button class="print-button" onclick="generatePDF()">Gerar PDF</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var element = document.getElementById('numero_processo');
            var maskOptions = {
                mask: '0000000-00.2X00.8.26.X344',
                definitions: {
                    X: {
                        mask: '0',
                        displayChar: '0',
                        placeholderChar: '0',
                    },
                },
                lazy: false,
                overwrite: 'shift',
            };
            var mask = IMask(element, maskOptions);

            // Adicionar evento change aos botões de rádio
            const radioOptions = document.querySelectorAll('input[name="forma_recebimento"]');
            const formFields = document.getElementById('form-fields');
            const hiddenFields = document.getElementById('hidden-fields');
            const pixFields = document.getElementById('pix-fields');
            const terceiroNome = document.getElementById('terceiro_nome');
            const titularTerceiro = document.getElementById('titular_terceiro');
            const declaration = document.querySelector('.declaration');
            const bancoSelect = document.getElementById('banco_select');
            const bancoOutro = document.getElementById('banco_outro');
            const codigoBanco = document.getElementById('codigo_banco');






            radioOptions.forEach(option => {
                option.addEventListener('change', function () {
                    formFields.classList.remove('hidden');
                    if (this.value === 'comparecer_banco') {
                        hiddenFields.classList.add('hidden');
                        pixFields.classList.add('hidden');
                    } else if (this.value === 'pix') {
                        hiddenFields.classList.add('hidden');
                        pixFields.classList.remove('hidden');
                    } else {
                        hiddenFields.classList.remove('hidden');
                        pixFields.classList.add('hidden');
                    }
                });
            });
            // Adicionar evento change ao botão de rádio "Terceiro"
            const titularContaOptions = document.querySelectorAll('input[name="titular_conta"]');
            titularContaOptions.forEach(option => {
                option.addEventListener('change', function () {
                    if (this.value === 'terceiro') {
                        terceiroNome.classList.remove('hidden');
                        updateDeclarationText();
                    } else {
                        terceiroNome.classList.add('hidden');
                        removeDeclarationText();
                    }
                });
            });

            // Adicionar evento input ao campo "Nome do Terceiro"
            terceiroNome.addEventListener('input', updateDeclarationText);
            function updateDeclarationText() {
                const nomeTerceiro = document.getElementById('terceiro_nome').value;
                let autorizacaoText = document.getElementById('autorizacao_text');
                if (!autorizacaoText) {
                    autorizacaoText = document.createElement('span');
                    autorizacaoText.id = 'autorizacao_text';
                    autorizacaoText.classList.add('hidden');
                    declaration.querySelector('p').appendChild(autorizacaoText);
                }
                autorizacaoText.textContent = ` Autorizo expressamente que o recebimento dos valores seja feito na conta indicada de ${nomeTerceiro}.`;
            }

            function removeDeclarationText() {
                const autorizacaoText = document.getElementById('autorizacao_text');
                if (autorizacaoText) {
                    autorizacaoText.remove();
                }
            }

            // Adicionar evento change ao dropdown "Banco"
            bancoSelect.addEventListener('change', function () {
                const selectedOption = bancoSelect.options[bancoSelect.selectedIndex];
                if (selectedOption.value === 'Outro') {
                    bancoSelect.style.width = '10px';
                    bancoOutro.classList.remove('hidden');
                    codigoBanco.removeAttribute('readonly');
                    codigoBanco.value = '';
                } else {
                    bancoOutro.classList.add('hidden');
                    codigoBanco.setAttribute('readonly', true);
                    codigoBanco.value = selectedOption.getAttribute('data-codigo');
                }
            });
        });

        function copyCpfCnpj() {
            const cpfCnpjCredor = document.getElementById('cpf_cnpj_credor').value;
            document.getElementById('cpf_cnpj_titular').value = cpfCnpjCredor;
        }

        function copyNome() {
            const nomeCredor = document.getElementById('nome_credor').value;
            document.getElementById('nome_titular').value = nomeCredor;
        }

        function copyCpfCnpjPix() {
            const cpfCnpjCredor = document.getElementById('cpf_cnpj_credor').value;
            document.getElementById('chave_pix').value = cpfCnpjCredor;
        }

        function copyNomePix() {
            const nomeCredor = document.getElementById('nome_credor').value;
            document.getElementById('nome_titular_pix').value = nomeCredor;
        }

        function generatePDF() {
            const element = document.querySelector('.container');
            const printButton = document.querySelector('.print-button');
            const copyButtons = document.querySelectorAll('.copy-button');
            const smallerSections = document.querySelectorAll('.inline-section.smaller-margin');
            const declaration = document.querySelector('.declaration');
            const nomeCredor = document.getElementById('nome_credor').value;
            const nomeCredorDeclaration = document.getElementById('nome_credor_declaration');
            const autorizacaoText = document.getElementById('autorizacao_text');

            // Ocultar o botão "Gerar PDF"
            printButton.style.display = 'none';
            copyButtons.forEach(button => {
                button.style.display = 'none';
            });

            // Exibir o texto de autorização no PDF
            if (autorizacaoText) {
                autorizacaoText.classList.remove('hidden');
            }
            // Exibir a declaração
            nomeCredorDeclaration.textContent = nomeCredor;
            declaration.style.display = 'block';



            // Substituir botões de rádio selecionados por "X" e não selecionados por "( )"
            const radioGroups = document.querySelectorAll('.radio-group');
            radioGroups.forEach(group => {
                const selectedRadio = group.querySelector('input[type="radio"]:checked');
                if (selectedRadio) {
                    const label = selectedRadio.nextSibling;
                    if (label && label.nodeType === Node.TEXT_NODE) {
                        const xSpan = document.createElement('span');
                        xSpan.textContent = '( X )';
                        xSpan.classList.add('radio-replacement');
                        label.parentNode.insertBefore(xSpan, label);
                        selectedRadio.style.display = 'none';
                    }
                }
                group.querySelectorAll('input[type="radio"]').forEach(radio => {
                    if (!radio.checked) {
                        const label = radio.nextSibling;
                        if (label && label.nodeType === Node.TEXT_NODE) {
                            const emptySpan = document.createElement('span');
                            emptySpan.innerHTML = '( )&nbsp;';
                            emptySpan.classList.add('radio-replacement');
                            label.parentNode.insertBefore(emptySpan, label);
                        }
                    }
                    radio.style.display = 'none';
                });
            });

            smallerSections.forEach(section => {
                section.classList.add('print-smaller-margin');
            });
            element.classList.add('no-border-on-pdf');

            html2pdf().set({
                margin: [10, 10, 10, 10],
                filename: 'Formulario_MLE.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).from(element).save().then(() => {
                // Mostrar o botão "Gerar PDF" novamente
                printButton.style.display = 'block';
                element.classList.remove('no-border-on-pdf');
                smallerSections.forEach(section => {
                    section.classList.remove('print-smaller-margin');
                });

                // Restaurar os botões de rádio
                radioGroups.forEach(group => {
                    group.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.style.display = 'inline-block';
                    });
                    group.querySelectorAll('.radio-replacement').forEach(span => {
                        span.remove();
                    });
                });

                // Ocultar o texto de autorização novamente
                if (autorizacaoText) {
                    autorizacaoText.classList.add('hidden');
                }
            }).catch(err => {
                console.error('Erro ao gerar PDF:', err);
                // Mostrar o botão "Gerar PDF" novamente em caso de erro
                printButton.style.display = 'block';
                element.classList.remove('no-border-on-pdf');
                smallerSections.forEach(section => {
                    section.classList.remove('print-smaller-margin');
                });

                // Restaurar os botões de rádio em caso de erro
                radioGroups.forEach(group => {
                    group.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.style.display = 'inline-block';
                    });
                    group.querySelectorAll('.radio-replacement').forEach(span => {
                        span.remove();
                    });
                });

                // Ocultar o texto de autorização novamente em caso de erro
                if (autorizacaoText) {
                    autorizacaoText.classList.add('hidden');
                }
            });
        }
    </script>
</body>

</html>