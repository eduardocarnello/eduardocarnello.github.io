<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário Interativo</title>

    <!-- Tailwind CSS para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Estilo customizado para o corpo da página e a fonte padrão */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        div#calendar-days {
            display: grid;
            justify-items: center;
        }

        /* Efeito de tooltip suave */
        .tooltip {
            transition: opacity 0.2s;
        }

        /* Nova classe para a textura de listras dos eventos internos */
        .internal-event-texture::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-image: repeating-linear-gradient(-45deg,
                    transparent,
                    transparent 4px,
                    rgba(0, 0, 0, 0.06) 4px,
                    rgba(0, 0, 0, 0.06) 8px);
            border-radius: 9999px;
            /* Mantém o formato arredondado */
            z-index: 0;
            /* Coloca as listras atrás do número do dia */
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">
        <!-- Seção do Calendário -->
        <div>
            <!-- Cabeçalho do Calendário com navegação -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-4">
                    <h2 id="month-year-header" class="text-3xl font-bold text-gray-800"></h2>
                    <!-- Switch de filtro -->
                    <div id="filter-switch-container" class="flex items-center space-x-2 pt-1">
                        <span class="text-sm font-medium text-gray-600">Incluir eventos internos</span>
                        <button type="button" id="internal-events-toggle"
                            class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent bg-gray-200 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2"
                            role="switch" aria-checked="false">
                            <span aria-hidden="true"
                                class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out translate-x-0"></span>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                        <i class="fas fa-chevron-left text-gray-600"></i>
                    </button>
                    <button id="next-month" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                        <i class="fas fa-chevron-right text-gray-600"></i>
                    </button>
                </div>
            </div>

            <!-- Dias da semana -->
            <div class="grid grid-cols-7 gap-2 text-center text-sm font-semibold text-gray-500 mb-2">
                <div>Dom</div>
                <div>Seg</div>
                <div>Ter</div>
                <div>Qua</div>
                <div>Qui</div>
                <div>Sex</div>
                <div>Sáb</div>
            </div>

            <!-- Grid dos dias do mês -->
            <div id="calendar-days" class="grid grid-cols-7 gap-2">
                <!-- Os dias serão gerados via JavaScript aqui -->
            </div>

            <!-- Legenda de Cores -->
            <div id="calendar-legend"
                class="mt-6 pt-4 border-t border-gray-200 flex flex-wrap gap-x-6 gap-y-3 justify-center">
                <!-- A legenda será gerada via JavaScript aqui -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURAÇÃO DE TIPOS DE EVENTOS ---
            const eventConfig = {
                ferias: { label: 'Férias', colorClass: 'bg-green-200', textColor: 'text-green-800', colorValue: '#bbf7d0' },
                licenca: { label: 'Licença-Prêmio', colorClass: 'bg-purple-200', textColor: 'text-purple-800', colorValue: '#e9d5ff' },
                falta: { label: 'Falta Compensada', colorClass: 'bg-orange-200', textColor: 'text-orange-800', colorValue: '#fed7aa' },
                substituicao: { label: 'Substituição Magistrado', colorClass: 'bg-red-200', textColor: 'text-red-800', colorValue: '#fecaca' },
                outro: { label: 'Outro', colorClass: 'bg-gray-300', textColor: 'text-gray-800', colorValue: '#d1d5db' },
                suspensao: { label: 'Suspensão de Expediente', colorClass: 'bg-blue-200', textColor: 'text-red-500', colorValue: '#bfdbfe', borderClass: 'border-2 border-red-600' },
                indisponibilidade: { label: 'Indisponibilidade de Sistema', colorClass: 'bg-yellow-200', textColor: 'text-yellow-800', colorValue: '#fde68a', borderClass: 'border-2 border-yellow-600' },
                severa: { label: 'Indisponibilidade Severa', colorClass: 'bg-red-600', textColor: 'text-white', colorValue: 'red', borderClass: 'border-2 border-black-500' },
                feriado: { label: 'Feriado', colorClass: 'bg-teal-200', textColor: 'text-red-600', colorValue: '#99f6e4', borderClass: 'border-2 border-red-600' },
                recesso: { label: 'Recesso / Suspensão RITJSP', colorClass: 'bg-gray-400', textColor: 'text-white', colorValue: '#9ca3af' },
            };

            // --- FONTES DE DADOS DE EVENTOS ---

            const amendment = [ //Emendas
                { holidayDate: "22/04/2022", description: "Suspensão de expediente (Prov. CSM 2641/2021)" },
                { holidayDate: "17/06/2022", description: "Suspensão de expediente (Prov. CSM 2641/2021)" },
                { holidayDate: "14/11/2022", description: "Suspensão de expediente (Prov. CSM 2641/2021)" },
                { holidayDate: "09/06/2023", description: "Suspensão de expediente (Prov. CSM 2678/2022)" },
                { holidayDate: "08/09/2023", description: "Suspensão de expediente (Prov. CSM 2678/2022)" },
                { holidayDate: "13/10/2023", description: "Suspensão de expediente (Prov. CSM 2678/2022)" },
                { holidayDate: "03/11/2023", description: "Suspensão de expediente (Prov. CSM 2678/2022)" },
                { holidayDate: "31/05/2024", description: "Suspensão de expediente (Prov. CSM 2728/2023)" },
                { holidayDate: "08/07/2024", description: "Suspensão de expediente (Prov. CSM 2728/2023)" },
                { holidayDate: "02/05/2025", description: "Suspensão de expediente (Prov. CSM 2765/2024)" },
                { holidayDate: "20/06/2025", description: "Suspensão de expediente (Prov. CSM 2765/2024)" },
                { holidayDate: "21/11/2025", description: "Suspensão de expediente (Prov. CSM 2765/2024)" },
            ];

            const sistDown = [ //Indisponibilidades
                { downDate: '09/02/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '10/03/2022', description: "INTERMITÊNCIA NA PASTA DIGITAL DO PORTAL E-SAJ", },
                { downDate: '25/03/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '28/03/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '29/03/2022', description: "INSTABILIDADE DO PETICIONAMENTO INTERMEDIÁRIO PARA PROCESSOS INCIDENTAIS DE 1º E 2º GRAU", },
                { downDate: '30/03/2022', description: "INSTABILIDADE DO PETICIONAMENTO INTERMEDIÁRIO PARA PROCESSOS INCIDENTAIS DE 1º E 2º GRAU", },
                { downDate: '31/03/2022', description: "INSTABILIDADE DO PETICIONAMENTO INTERMEDIÁRIO PARA PROCESSOS INCIDENTAIS DE 1º E 2º GRAU", },
                { downDate: '04/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO INTERMEDIÁRIO PARA PROCESSOS INCIDENTAIS DE 1º E 2º GRAU", },
                { downDate: '06/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '07/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '08/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '11/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '12/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '13/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '18/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '19/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '20/04/2022', description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU", },
                { downDate: '09/05/2022', description: "INDISPONIBILIDADE PARA DOWNLOAD DOS AUTOS EM 1º, 2º GRAU E COL. RECURSAL", },
                { downDate: '13/05/2022', description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DE 1ª E 2ª INSTÂNCIAS E DO COLÉGIO RECURSAL", },
                { downDate: '13/06/2022', description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DE 1ª INSTÂNCIA", },
                { downDate: `16/05/2022`, description: "INDISPONIBILIDADE SEVERA NA PASTA DIGITAL DO PORTAL E-SAJ" },
                { downDate: '29/06/2022', description: "INSTABILIDADE PARA VISUALIZAÇÃO E DOWNLOAD DOS AUTOS EM 1º GRAU", },
                { downDate: '01/07/2022', description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL E PETICIONAMENTO DE 1ª, 2ª INSTÂNCIA E COL. RECURSAL", },
                { downDate: '11/07/2022', description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DOS PROCESSOS DE 1ª INSTÂNCIA", },
                { downDate: '13/07/2022', description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL E PETICIONAMENTO DE 1ª, 2ª INSTÂNCIA E COL. RECURSAL", },
                { downDate: `18/07/2022`, description: "INDISPONIBILIDADE SEVERA NA PASTA DIGITAL DO PORTAL E-SAJ" },
                { downDate: `20/07/2022`, description: "INDISPONIBILIDADE SEVERA NA PASTA DIGITAL DO PORTAL E-SAJ" },
                { downDate: `08/08/2022`, description: "MANUTENÇÃO PREVENTIVA IMPRESCINDÍVEL DO DATACENTER - INDISPONIBILIDADE DE SISTEMAS" },
                { downDate: `30/09/2022`, description: "INDISPONIBILIDADE DE AUTENTICAÇÃO NO PORTAL E-SAJ" },
                { downDate: `25/10/2022`, description: "INDISPONIBILIDADE DO PETICIONAMENTO ELETRÔNICO INICIAL E INTERMEDIÁRIO DE 1º GRAU" },
                { downDate: `26/10/2022`, description: "INDISPONIBILIDADE DO PETICIONAMENTO ELETRÔNICO INICIAL E INTERMEDIÁRIO DE 1º GRAU" },
                { downDate: `24/11/2022`, description: "Encerramento de expediente antecipadamente - Provimento CSM nº 2.672/2022" },
                { downDate: `28/11/2022`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `02/12/2022`, description: "Encerramento de expediente antecipadamente - Provimento CSM nº 2.672/2022" },
                { downDate: `05/12/2022`, description: "Encerramento de expediente antecipadamente - Provimento CSM nº 2.672/2022" },
                { downDate: `19/01/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DE 1ª INSTÂNCIA DA BASE JM DO SAJ" },
                { downDate: `27/01/2023`, description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU E DO COLÉGIO RECURSAL" },
                { downDate: `13/02/2023`, description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º GRAU" },
                { downDate: `15/02/2023`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `07/03/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `16/03/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DE 1ª E 2ª INSTÂNCIA DO PORTAL E-SAJ" },
                { downDate: `28/03/2023`, description: "INDISPONIBILIDADE PARA AUTENTICAÇÃO NO PORTAL E-SAJ" },
                { downDate: `13/04/2023`, description: "INSTABILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `02/05/2023`, description: "INDISPONIBILIDADE DO PETICIONAMENTO ELETRONICO INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU" },
                { downDate: `25/05/2023`, description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU E DO COLÉGIO RECURSAL" },
                { downDate: `26/05/2023`, description: "INSTABILIDADE DO PETICIONAMENTO DE INICIAL E INTERMEDIÁRIA DE 1º E 2º GRAU E DO COLÉGIO RECURSAL" },
                { downDate: `12/06/2023`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `28/07/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `16/08/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `18/08/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `28/08/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `09/10/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `10/10/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL 1ª INSTÂNCIA" },
                { downDate: `08/11/2023`, description: "INDISPONIBILIDADE DO PETICIONAMENTO ELETRONICO INICIAL E INTERMEDIÁRIA" },
                { downDate: `21/11/2023`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DE 1º GRAU NO PORTAL E-SAJ" },
                { downDate: `29/01/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ." },
                { downDate: `15/03/2024`, description: "INDISPONIBILIDADE SEVERA - 1º DIA (Comunicado Conjunto 239/2024)." },
                { downDate: `10/04/2024`, description: "INDISPONIBILIDADE NA CONSULTA DE 1º GRAU" },
                { downDate: `11/04/2024`, description: "INDISPONIBILIDADE NA CONSULTA DE 1º GRAU" },
                { downDate: `07/05/2024`, description: "INDISPONIBILIDADE DO PETICIONAMENTO ELETRÔNICO DE 1º GRAU" },
                { downDate: `13/05/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `12/06/2024`, description: "INDISPONIBILIDADE DO PETICIONAMENTO ELETRÔNICO" },
                { downDate: `20/06/2024`, description: "INDISPONIBILIDADE DE IDENTIFICAÇÃO COM O CERTIFICADO DIGITAL" },
                { downDate: `10/07/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `11/07/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `12/07/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `30/07/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `31/07/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `04/09/2024`, description: "INDISPONIBILIDADE NA CONSULTA PROCESSUAL DE 1º GRAU DO PORTAL E-SAJ" },
                { downDate: `16/09/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ - INTEGRADOR CNA (OAB)" },
                { downDate: `17/09/2024`, description: "INDISPONIBILIDADE DA CONSULTA PROCESSUAL" },
                { downDate: `03/10/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `07/10/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `07/11/2024`, description: "INDISPONIBILIDADE DA CONSULTA PROCESSUAL DE 1º GRAU DO PORTAL E-SAJ" },
                { downDate: `21/11/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ - INTEGRADOR CNA (OAB)" },
                { downDate: `22/11/2024`, description: "INDISPONIBILIDADE NOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `25/11/2024`, description: "INDISPONIBILIDADE NOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `26/11/2024`, description: "INDISPONIBILIDADE NOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `09/12/2024`, description: "INDISPONIBILIDADE DOS SERVIÇOS DE CONSULTA PROCESSUAL E VISUALIZAÇÃO DA PASTA DIGITAL" },
                { downDate: `12/12/2024`, description: "INDISPONIBILIDADE NOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `30/01/2025`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ - INTEGRADOR CNA (OAB)" },
                { downDate: `03/02/2025`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ - INTEGRADOR CNA (OAB)" },
                { downDate: `04/02/2025`, description: "INDISPONIBILidade DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `10/02/2025`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `11/02/2025`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `19/02/2025`, description: "INDISPONIBILIDADE NO SERVIÇO DE PETICIONAMENTO ELETRÔNICO DO PORTAL E-SAJ" },
                { downDate: `10/03/2025`, description: "INDISPONIBILIDADE DOS SERVIÇOS DO PORTAL E-SAJ" },
                { downDate: `28/03/2025`, description: "INDISPONIBILIDADE DA CONSULTA PROCESSUAL DE 1º GRAU DO PORTAL E-SAJ" },
                { downDate: `23/04/2025`, description: "INDISPONIBILIDADE SEVERA NO SERVIÇO DE PASTA DIGITAL DO E-SAJ" },
                { downDate: `12/09/2025`, description: "INDISPONIBILIDADE NO SERVIÇO DE PETICIONAMENTO ELETRÔNICO DO PORTAL E-SAJ" },
                { downDate: `15/09/2025`, description: "INDISPONIBILIDADE NO SERVIÇO DE LOGIN DO PORTAL E-SAJ" },
            ];

            const severeDownEvents = [
                { startDate: `06/11/2023`, description: "Suspensão de Prazo - Comunicado nº 435/2023", type: 'severa' },
                { startDate: `07/11/2023`, description: "Suspensão de Prazo - Comunicado nº 435/2023", type: 'severa' },
                { startDate: `18/03/2024`, endDate: `22/03/2024`, description: "Suspensão de Prazo - Comunicado Conjunto nº 293/2024", type: 'severa' },
                { startDate: `24/04/2025`, description: "INDISPONIBILIDADE SEVERA NO SERVIÇO DE PASTA DIGITAL DO E-SAJ", type: 'severa' },
                { startDate: `12/05/2025`, endDate: `16/05/2025`, description: "Suspensão de Prazo - Comunicado Conjunto nº 325/2025 - Treinamento Eproc", type: 'severa' },
            ];
            const initialEvents = [
                { startDate: '01/10/2025', endDate: '15/10/2025', type: 'ferias', description: 'Férias do Sandro' },
                { startDate: '03/10/2025', type: 'falta', description: 'Falta do Antonio' },
                { startDate: '08/10/2025', type: 'falta', description: 'Falta da Tifany' },
                { startDate: '03/11/2025', type: 'outro', description: 'Correição Ordinária' },
                { startDate: '03/10/2025', endDate: '17/10/2025', type: 'ferias', description: 'Férias do Helton Marcelo ' },
                { startDate: '13/10/2025', endDate: '27/10/2025', type: 'ferias', description: 'Férias da Sandra' },
                { startDate: '31/10/2025', endDate: '14/11/2025', type: 'ferias', description: 'Férias do Beto' },
                { startDate: '06/10/2025', endDate: '08/10/2025', type: 'falta', description: 'Compensada Helton' },
                { startDate: '26/09/2025', type: 'substituicao', description: 'Acumulação (DEJESP 18/09/2025)', details: 'Dr. José Augusto Franca Junior ' },
            ];

            const amendmentEvents = amendment.map(e => ({ startDate: e.holidayDate, description: e.description, type: 'suspensao' }));
            const sistDownEvents = sistDown.map(e => ({ startDate: e.downDate, description: e.description, type: 'indisponibilidade' }));

            const formatDate = (date) => { /* ... */ };
            const Easter = (Y) => { /* ... */ };

            const holidaysFunc = (startYear, endYear) => {
                const allHolidays = [];
                const city = 'Marília';
                for (let i = startYear; i <= endYear; i++) {
                    const easterDate = Easter(i);
                    const addDays = (date, days) => { const newDate = new Date(date); newDate.setDate(newDate.getDate() + days); return newDate; };
                    const yearHolidays = [
                        ...Array.from({ length: 12 }, (_, k) => ({ date: `20/12/${i - 1}`.slice(0, -1) + (i + k - 20), description: "Recesso - Art. 116, § 2º do RITJSP" })).map(e => ({ startDate: e.date, description: e.description, type: 'recesso' })),
                        ...[...Array(12)].map((_, k) => ({ startDate: `${20 + k}/12/${i}`, description: "Recesso - Art. 116, § 2º do RITJSP", type: 'recesso' })),
                        ...[...Array(6)].map((_, k) => ({ startDate: `0${1 + k}/01/${i}`, description: "Recesso - Art. 116, § 2º do RITJSP", type: 'recesso' })),
                        ...[...Array(14)].map((_, k) => ({ startDate: `${k + 7}/01/${i}`, description: "Art. 116, § 2º do RITJSP", type: 'recesso' })),
                        { startDate: formatDate(addDays(easterDate, -48)), description: "Véspera de Carnaval", type: 'feriado' }, { startDate: formatDate(addDays(easterDate, -47)), description: "Carnaval", type: 'feriado' },
                        { startDate: formatDate(addDays(easterDate, -3)), description: "Endoenças", type: 'feriado' }, { startDate: formatDate(addDays(easterDate, -2)), description: "Sexta-feira Santa", type: 'feriado' },
                        { startDate: formatDate(easterDate), description: "Páscoa", type: 'feriado' }, { startDate: formatDate(addDays(easterDate, 60)), description: "Corpus Christi", type: 'feriado' },
                        { startDate: `01/01/${i}`, description: "Confraternização Universal", type: 'feriado' }, { startDate: `21/04/${i}`, description: "Tiradentes", type: 'feriado' },
                        { startDate: `01/05/${i}`, description: "Dia do Trabalhador", type: 'feriado' }, { startDate: `07/09/${i}`, description: "Independência do Brasil", type: 'feriado' },
                        { startDate: `12/10/${i}`, description: "Nossa Senhora Aparecida, Padroeira do Brasil", type: 'feriado' }, { startDate: `02/11/${i}`, description: "Finados", type: 'feriado' },
                        { startDate: `15/11/${i}`, description: "Proclamação da República", type: 'feriado' }, { startDate: i === 2020 ? `30/10/${i}` : i === 2025 ? `27/10/${i}` : `28/10/${i}`, description: 'Dia do Servidor Público', type: 'feriado' },
                        { startDate: i === 2022 ? `09/12/${i}` : `08/12/${i}`, description: 'Dia da Justiça', type: 'feriado' }, { startDate: i >= 2023 ? `20/11/${i}` : null, description: "Consciência Negra", type: 'feriado' },
                        { startDate: `25/12/${i}`, description: "Natal", type: 'feriado' }, { startDate: `09/07/${i}`, description: "Revolução Constitucionalista de São Paulo", type: 'feriado' },
                        { startDate: `04/04/${i}`, description: "Fundação da Cidade", city: "Marília", type: 'feriado' }, { startDate: i === 2023 ? "10/07/2023" : i === 2024 ? "08/07/2024" : `11/07/${i}`, description: "São Bento, Padroeiro da Cidade", city: 'Marília', type: 'feriado' },
                    ].filter(e => e.startDate && (!e.city || e.city === city));
                    allHolidays.push(...yearHolidays);
                }
                return allHolidays;
            };

            const generatedHolidays = holidaysFunc(2022, 2026);
            const allEvents = [...initialEvents, ...amendmentEvents, ...sistDownEvents, ...severeDownEvents, ...generatedHolidays];

            // --- LÓGICA DO CALENDÁRIO E FILTRO ---
            const monthYearHeader = document.getElementById('month-year-header');
            const calendarDays = document.getElementById('calendar-days');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const legendContainer = document.getElementById('calendar-legend');
            const toggleButton = document.getElementById('internal-events-toggle');
            const toggleCircle = toggleButton.querySelector('span');
            let currentDate = new Date();

            let showInternalEvents = false;
            const internalEventTypes = ['ferias', 'licenca', 'falta', 'substituicao', 'outro'];
            const officialEventTypes = ['feriado', 'suspensao', 'recesso', 'indisponibilidade', 'severa'];

            toggleButton.addEventListener('click', () => {
                showInternalEvents = !showInternalEvents;
                toggleButton.setAttribute('aria-checked', showInternalEvents);
                if (showInternalEvents) {
                    toggleButton.classList.replace('bg-gray-200', 'bg-blue-600');
                    toggleCircle.classList.replace('translate-x-0', 'translate-x-5');
                } else {
                    toggleButton.classList.replace('bg-blue-600', 'bg-gray-200');
                    toggleCircle.classList.replace('translate-x-5', 'translate-x-0');
                }
                renderCalendar();
                renderLegend();
            });

            const parseDate = (str) => {
                if (!str) return null;
                const parts = str.split('/');
                if (parts.length !== 3) return null;
                const [day, month, year] = parts.map(Number);
                if (isNaN(day) || isNaN(month) || isNaN(year) || String(year).length < 4) return null;
                return new Date(year, month - 1, day);
            };

            const adjustColor = (hex, percent) => {
                hex = hex.replace('#', '');
                let r = parseInt(hex.substring(0, 2), 16);
                let g = parseInt(hex.substring(2, 4), 16);
                let b = parseInt(hex.substring(4, 6), 16);
                r = Math.min(255, Math.floor(r * (1 + percent / 100)));
                g = Math.min(255, Math.floor(g * (1 + percent / 100)));
                b = Math.min(255, Math.floor(b * (1 + percent / 100)));
                const toHex = c => ('00' + c.toString(16)).slice(-2);
                return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
            };

            const renderLegend = () => {
                legendContainer.innerHTML = '';
                let typesToRender = showInternalEvents ? Object.keys(eventConfig) : officialEventTypes;
                for (const type of typesToRender) {
                    if (eventConfig[type]) {
                        const config = eventConfig[type];
                        const legendItem = document.createElement('div');
                        legendItem.className = 'flex items-center gap-2';
                        legendItem.innerHTML = `<div class="w-4 h-4 rounded-full ${config.colorClass}"></div><span class="text-sm text-gray-700">${config.label}</span>`;
                        legendContainer.appendChild(legendItem);
                    }
                }
            };

            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                monthYearHeader.textContent = currentDate.toLocaleString('pt-BR', { month: 'long', year: 'numeric' }).replace(/^\w/, c => c.toUpperCase());
                calendarDays.innerHTML = '';
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const lastDateOfMonth = new Date(year, month + 1, 0).getDate();

                const eventsToDisplay = allEvents.filter(e => {
                    if (officialEventTypes.includes(e.type)) {
                        return true; // Always show official events
                    }
                    if (showInternalEvents && internalEventTypes.includes(e.type)) {
                        return true; // Show internal events only if toggle is on
                    }
                    return false;
                });

                for (let i = 0; i < firstDayOfMonth; i++) calendarDays.innerHTML += '<div></div>';

                for (let day = 1; day <= lastDateOfMonth; day++) {
                    const dayElement = document.createElement('div');
                    const currentDateObj = new Date(year, month, day);
                    dayElement.innerHTML = `<span class="relative z-10">${day}</span>`;
                    dayElement.className = 'h-12 w-12 flex items-center justify-center rounded-full transition-colors cursor-default relative';

                    const dailyEvents = eventsToDisplay.filter(e => {
                        if (!e.startDate) return false;
                        const start = parseDate(e.startDate); if (!start) return false;
                        const end = e.endDate ? parseDate(e.endDate) : start; if (!end) return false;
                        return currentDateObj >= start && currentDateObj <= end;
                    });

                    if (dailyEvents.length > 0) {
                        dayElement.classList.add('font-semibold', 'group');
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip pointer-events-none absolute z-20 w-max max-w-xs p-3 -top-2 transform -translate-y-full -translate-x-1/2 left-1/2 bg-gray-800 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100';
                        tooltip.innerHTML = dailyEvents.map(event => `&bull; ${event.description}${event.type === 'substituicao' && event.details ? ` (Juiz: ${event.details})` : ''}`).join('<br>');
                        dayElement.appendChild(tooltip);

                        if (dailyEvents.length === 1) {
                            const config = eventConfig[dailyEvents[0].type];
                            if (config) {
                                dayElement.classList.add(config.colorClass, config.textColor);
                                if (config.borderClass) dayElement.classList.add(...config.borderClass.split(' '));
                            }
                        } else {
                            const typeCounts = new Map();
                            const colors = dailyEvents.slice(0, 4).map(event => {
                                const config = eventConfig[event.type]; if (!config) return '#d1d5db';
                                const count = typeCounts.get(event.type) || 0; typeCounts.set(event.type, count + 1);
                                return count > 0 ? adjustColor(config.colorValue, count * 20) : config.colorValue;
                            });
                            const gradientStops = colors.map((color, i) => `${color} ${i * (100 / colors.length)}%, ${color} ${(i + 1) * (100 / colors.length)}%`).join(', ');
                            dayElement.style.backgroundImage = `linear-gradient(135deg, ${gradientStops})`;
                            dayElement.classList.add('text-gray-800');
                            const eventWithBorder = dailyEvents.find(e => eventConfig[e.type]?.borderClass);
                            if (eventWithBorder) {
                                dayElement.classList.add(...eventConfig[eventWithBorder.type].borderClass.split(' '));
                            }
                        }

                        const hasInternalEvent = dailyEvents.some(e => internalEventTypes.includes(e.type));
                        if (hasInternalEvent) {
                            dayElement.classList.add('internal-event-texture');
                        }
                    }

                    const today = new Date();
                    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        const textColors = Array.from(dayElement.classList).filter(c => c.startsWith('text-'));
                        dayElement.classList.remove(...textColors);
                        dayElement.classList.add('border-2', 'font-bold', 'border-blue-800', 'text-blue-800');
                    }

                    calendarDays.appendChild(dayElement);
                }
                const totalGridCells = firstDayOfMonth + lastDateOfMonth;
                for (let i = totalGridCells; i < 42; i++) {
                    calendarDays.innerHTML += '<div></div>';
                }
            };

            prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
            nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });

            renderCalendar();
            renderLegend();
        });
    </script>
</body>

</html>