<!DOCTYPE html>
<html lang="pt-BR" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base de Conhecimento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body,
        html {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        /* ... (estilos CSS inalterados) ... */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .focus-ring-visible:focus-visible {
            outline: 2px solid #2563eb;
            outline-offset: 2px;
        }

        /* Estilos do Conteúdo do Artigo (Modal) */
        #modal-content h1,
        #modal-ciencia-content h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        #modal-content h2,
        #modal-ciencia-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
        }

        #modal-content h3,
        #modal-ciencia-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        #modal-content p,
        #modal-ciencia-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        #modal-content ul,
        #modal-ciencia-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            padding-left: 0.5rem;
        }

        #modal-content ol,
        #modal-ciencia-content ol {
            list-style-type: decimal;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            padding-left: 0.5rem;
        }

        #modal-content li,
        #modal-ciencia-content li {
            margin-bottom: 0.5rem;
        }

        #modal-content a,
        #modal-ciencia-content a {
            color: #2563eb;
            text-decoration: underline;
        }

        #modal-content a:hover,
        #modal-ciencia-content a:hover {
            color: #1d4ed8;
        }

        #modal-content blockquote,
        #modal-ciencia-content blockquote {
            border-left: 4px solid #94a3b8;
            padding-left: 1rem;
            margin-left: 0;
            margin-bottom: 1rem;
            font-style: italic;
            color: #475569;
        }

        #modal-content pre.ql-syntax,
        #modal-ciencia-content pre.ql-syntax {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            font-family: monospace;
        }

        #modal-content img,
        #modal-ciencia-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        div#modal-metadata {
            margin-top: 0.2rem;
        }
    </style>
</head>

<body class="bg-slate-100 h-full flex flex-col">

    <!-- Seção de Login (Começa oculta para evitar "piscada") -->
    <section id="login-section" style="display: none;"
        class="min-h-full flex-grow flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8 bg-white p-10 rounded-2xl shadow-xl">
            <div>
                <svg class="mx-auto h-12 w-auto text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" />
                </svg>
                <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                    Acessar Base de Conhecimento
                </h2>
                <p class="mt-2 text-center text-sm text-gray-600">
                    Este é um portal privado.
                </p>
            </div>

            <!-- Mensagem de Erro/Status -->
            <div id="login-status" class="text-center text-red-500 font-medium"></div>

            <div class="space-y-4 pt-6">
                <!-- Botão Login Google -->
                <button id="google-login-btn"
                    class="group relative w-full flex justify-center py-3 px-4 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                    <img class="w-5 h-5 mr-2" src="https://www.svgrepo.com/show/475656/google-color.svg"
                        alt="Google icon">
                    Entrar com Google
                </button>

            </div>

        </div>
    </section>

    <!-- Seção de Conteúdo (Começa oculta para evitar "piscada") -->
    <section id="content-section" style="display: none;" class="flex-grow">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <!-- Logo e Título -->
                    <div class="flex-shrink-0 flex items-center">
                        <svg class="h-10 w-auto text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" />
                        </svg>
                        <span class="ml-3 text-2xl font-bold text-slate-800">Base de Conhecimento</span>
                    </div>

                    <!-- Botões de Admin e Sair -->
                    <div class="flex items-center gap-4">
                        <!-- NOVO: Exibição de Cargo -->
                        <span id="user-info" class="text-sm text-slate-600 hidden sm:block">
                            <span id="user-email" class="font-medium"></span>
                            (<span id="user-role" class="font-light"></span>)
                        </span>
                        <a href="admin.html" id="admin-btn"
                            class="hidden text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors focus-ring-visible rounded-md p-1">
                            Painel Admin
                        </a>
                        <button id="logout-btn"
                            class="text-sm font-medium text-red-600 hover:text-red-800 transition-colors focus-ring-visible rounded-md p-1">
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Seção de Busca -->
        <div class="bg-slate-800 py-12 sm:py-16">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="max-w-3xl mx-auto text-center">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-white">Como podemos ajudar?</h1>
                    <p class="mt-4 text-lg text-slate-300">
                        Pesquise comunicados, provimentos, orientações e mais.
                    </p>
                </div>
                <!-- Barra de Busca -->
                <div class="max-w-3xl mx-auto mt-8">
                    <div class="relative">
                        <input type="search" id="search-input" placeholder="Pesquisar artigos..."
                            class="w-full p-4 pl-12 text-lg text-slate-900 bg-white rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 transition-shadow">
                        <div class="absolute left-4 top-1/2 -translate-y-1/2">
                            <svg class="w-6 h-6 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </div>
                    </div>
                    <!-- Filtro de Campo de Busca -->
                    <div class="max-w-xs mx-auto mt-4">
                        <label for="search-field" class="sr-only">Pesquisar em:</label>
                        <select id="search-field"
                            class="w-full py-2 px-3 bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus-ring-visible">
                            <option value="all">Todos os Campos</option>
                            <option value="title">Apenas no Título</option>
                            <option value="summary">Apenas no Resumo</option>
                            <option value="tags">Apenas nas Tags</option>
                            <option value="content">Apenas no Conteúdo</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo Principal -->
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 flex-grow">
            <div class="flex flex-col lg:flex-row gap-8 lg:gap-12">

                <!-- Sidebar de Categorias (Lateral) -->
                <aside class="w-full lg:w-1/4 xl:w-1/5">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">Categorias</h2>
                    <nav id="category-grid" class="space-y-2">
                        <!-- Botão "Todos" -->
                        <button
                            class="category-card w-full flex items-center gap-3 p-3 rounded-lg text-left font-medium transition-colors duration-150 focus-ring-visible bg-blue-600 text-white shadow-lg"
                            data-category="TODOS">
                            <div
                                class="w-8 h-8 flex-shrink-0 flex items-center justify-center rounded-lg bg-white bg-opacity-20">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                                </svg>
                            </div>
                            <span>Todos</span>
                        </button>

                        <!-- Mensagem de Carregamento de Categorias -->
                        <div id="categories-loading" class="text-slate-500">Carregando categorias...</div>

                        <!-- Categorias dinâmicas vêm aqui -->
                    </nav>
                </aside>

                <!-- Grid de Artigos (Principal) -->
                <section class="w-full lg:w-3/4 xl:w-4/5">
                    <h2 id="articles-title" class="text-2xl font-bold text-slate-800 mb-6">
                        Artigos Recentes
                    </h2>

                    <!-- Mensagem de Status (Carregando, Erro, Vazio) -->
                    <div id="articles-status" class="text-center text-slate-500 py-10">
                        <svg class="mx-auto h-12 w-12 text-slate-400 animate-spin" xmlns="http://www.w3.org/2000/svg"
                            fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <p class="mt-4 text-lg font-medium">Carregando artigos...</p>
                    </div>

                    <!-- Container dos Cards de Artigo -->
                    <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Cards de artigo vêm aqui -->
                    </div>

                    <!-- Botão Carregar Mais -->
                    <div id="load-more-container" class="text-center mt-12 hidden">
                        <button id="load-more-btn"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105 focus-ring-visible">
                            Carregar Mais 10 Artigos
                        </button>
                    </div>

                </section>
            </div>
        </main>
    </section>

    <!-- Modal de Artigo (Começa oculto) -->
    <div id="modal-backdrop"
        class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden transition-opacity duration-300 ease-out"
        aria-hidden="true" style="opacity: 0;"></div>

    <div id="modal-container" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">

        <div id="modal-panel"
            class="bg-white rounded-2xl shadow-xl w-full h-full  transform transition-all duration-300 ease-out scale-95 opacity-0">
            <!-- Cabeçalho do Modal -->
            <header
                class="sticky top-0 bg-white p-4 sm:p-6 border-b border-slate-200  flex justify-between items-center">
                <h3 id="modal-title" class="text-xl sm:text-2xl font-bold text-slate-800 break-words pr-4">
                    Carregando Título...
                </h3>
                <button id="modal-close-btn"
                    class="p-2 -m-2 rounded-full text-slate-400 hover:text-slate-700 hover:bg-slate-100 transition-colors focus-ring-visible">
                    <span class="sr-only">Fechar</span>
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </header>

            <!-- Conteúdo do Modal (com scroll) -->
            <div id="modal-body" class="overflow-y-auto p-6 space-y-4">
                <!-- Carregador do Modal -->
                <div id="modal-loading-spinner" class="text-center py-10">
                    <svg class="mx-auto h-8 w-8 text-slate-400 animate-spin" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <p class="mt-3 text-slate-500">Carregando conteúdo...</p>
                </div>

                <!-- Metadados do Artigo -->
                <div id="modal-metadata" class="hidden border-b border-slate-200 pb-4 mb-4 space-y-3">
                    <!-- Categoria -->
                    <div id="modal-category-badge" class="flex items-center gap-2">
                        <!-- Badge vem aqui -->
                    </div>
                    <!-- Data -->
                    <div class="flex items-center gap-2 text-sm text-slate-500">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                        </svg>
                        Publicado em: <span id="modal-date">--</span>
                    </div>
                    <!-- Resumo -->
                    <p id="modal-summary" class="text-base text-slate-600 italic"></p>
                    <!-- Tags (ÍCONE DE ETIQUETA ATUALIZADO) -->
                    <div id="modal-tags-container"
                        class="hidden flex flex-wrap gap-2 items-center text-sm text-slate-500">
                        <svg class="w-4 h-4 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M5.5 16.5A1.5 1.5 0 014 15V5a1.5 1.5 0 011.5-1.5h5.138a1.5 1.5 0 011.06.44l5.862 5.861a1.5 1.5 0 010 2.122l-5.137 5.137a1.5 1.5 0 01-1.061.44H5.5zM6 6a1 1 0 100-2 1 1 0 000 2z" />
                        </svg>
                        <span id="modal-tags-list">
                            <!-- Tags vêm aqui -->
                        </span>
                    </div>
                </div>

                <!-- Conteúdo do Artigo (do Quill) -->
                <div id="modal-content">
                    <!-- Conteúdo vem aqui -->
                </div>

                <!-- MÚLTIPLOS LINKS (Inalterado) -->
                <div id="modal-links-container" class="hidden pt-4 border-t border-slate-200 space-y-3">
                    <h4 class="font-semibold text-slate-700">Links de Referência:</h4>
                    <ul id="modal-links-list" class="list-disc list-inside space-y-2">
                        <!-- Links vêm aqui -->
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <!-- ETAPA 3.B: Modal de CIÊNCIA (Começa oculto) -->
    <div id="modal-ciencia-backdrop"
        class="fixed inset-0 bg-slate-900 bg-opacity-90 z-[60] hidden transition-opacity duration-300 ease-out"
        aria-hidden="true" style="opacity: 0;"></div>

    <div id="modal-ciencia-container" class="fixed inset-0 flex items-center justify-center p-4 sm:p-0 z-[70] hidden"
        role="dialog" aria-modal="true" aria-labelledby="modal-ciencia-title">

        <!-- Painel de Tela Cheia -->
        <div id="modal-ciencia-panel"
            class="bg-white shadow-xl max-w-3xl flex flex-col transform transition-all duration-300 ease-out scale-95 opacity-0">

            <!-- Cabeçalho do Modal de Ciência -->
            <header
                class="sticky top-0 bg-white p-4 sm:p-6 border-b border-slate-200 flex justify-between items-center z-10">
                <div class="flex flex-col">
                    <span class="text-sm font-semibold text-red-600">LEITURA OBRIGATÓRIA</span>
                    <h3 id="modal-ciencia-title" class="text-xl sm:text-2xl font-bold text-slate-800 break-words pr-4">
                        Carregando Título...
                    </h3>
                </div>
                <!-- Botão de fechar é PROPOSITALMENTE OMITIDO para forçar a ciência -->
            </header>

            <!-- Conteúdo do Modal de Ciência (com scroll) -->
            <div id="modal-ciencia-body" class="overflow-y-auto p-6 space-y-4 flex-grow">
                <!-- Carregador -->
                <div id="ciencia-loading-spinner" class="text-center py-10">
                    <svg class="mx-auto h-8 w-8 text-slate-400 animate-spin" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <p class="mt-3 text-slate-500">Carregando conteúdo...</p>
                </div>

                <!-- Conteúdo do Artigo (do Quill) -->
                <div id="modal-ciencia-content" class="hidden">
                    <!-- O conteúdo será injetado aqui -->
                </div>
            </div>

            <!-- Rodapé de Navegação e Ação -->
            <footer class="bg-gray-50 p-4 border-t border-slate-200">
                <div class="flex justify-between items-center">
                    <button type="button" id="ciencia-prev-btn"
                        class="hidden items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-900 focus-ring-visible rounded-md p-2">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                        </svg>
                        Anterior
                    </button>
                    <!-- Espaçador -->
                    <span></span>

                    <div class="flex items-center gap-4">
                        <span id="ciencia-counter" class="text-sm text-slate-500"></span>
                        <button type="button" id="ciencia-next-btn"
                            class="hidden items-center gap-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus-ring-visible rounded-lg py-2 px-4">
                            Próximo
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                            </svg>
                        </button>
                        <button type="button" id="declarar-ciencia-btn"
                            class="hidden items-center gap-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus-ring-visible rounded-lg py-2 px-4 disabled:bg-gray-400">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Declarar Ciência
                        </button>
                        <div id="ciencia-status" class="text-sm text-red-500 font-medium"></div>
                    </div>
                </div>
            </footer>
        </div>
    </div>


    <!-- Firebase SDKs -->
    <script type="module">
        // Importações do Firebase (APENAS AUTH)
        import { initializeApp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            onAuthStateChanged,
            signInWithPopup,
            GoogleAuthProvider,
            OAuthProvider,
            signOut,
            getIdToken
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyChhpPXpLTFGQfvJH55D_uQ2FG5PdKykcQ",
            authDomain: "minha-base-conhecimento.firebaseapp.com",
            projectId: "minha-base-conhecimento",
            storageBucket: "minha-base-conhecimento.firebasestorage.app",
            messagingSenderId: "586899421039",
            appId: "1:586899421039:web:99be661136602118175a9a"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();
        const microsoftProvider = new OAuthProvider('microsoft.com');
        setLogLevel('Debug');

        // --- REFERÊNCIAS DO DOM ---
        // Seções
        const loginSection = document.getElementById('login-section');
        const contentSection = document.getElementById('content-section');
        // Login
        const loginStatus = document.getElementById('login-status');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const microsoftLoginBtn = document.getElementById('microsoft-login-btn');
        // Header (Conteúdo)
        const logoutBtn = document.getElementById('logout-btn');
        const adminBtn = document.getElementById('admin-btn');
        const userInfo = document.getElementById('user-info');
        const userEmailSpan = document.getElementById('user-email');
        const userRoleSpan = document.getElementById('user-role');
        // Busca
        const searchInput = document.getElementById('search-input');
        const searchField = document.getElementById('search-field');
        const articlesTitle = document.getElementById('articles-title');
        // Categorias
        const categoryGrid = document.getElementById('category-grid');
        const categoriesLoading = document.getElementById('categories-loading');
        // Artigos
        const articlesGrid = document.getElementById('articles-grid');
        const articlesStatus = document.getElementById('articles-status');
        const loadMoreContainer = document.getElementById('load-more-container');
        const loadMoreBtn = document.getElementById('load-more-btn');

        // Modal de Artigo Normal
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContainer = document.getElementById('modal-container');
        const modalPanel = document.getElementById('modal-panel');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalLoadingSpinner = document.getElementById('modal-loading-spinner');
        const modalMetadata = document.getElementById('modal-metadata');
        const modalCategoryBadge = document.getElementById('modal-category-badge');
        const modalDate = document.getElementById('modal-date');
        const modalSummary = document.getElementById('modal-summary');
        const modalTagsContainer = document.getElementById('modal-tags-container');
        const modalTagsList = document.getElementById('modal-tags-list');
        const modalContent = document.getElementById('modal-content');
        const modalLinksContainer = document.getElementById('modal-links-container');
        const modalLinksList = document.getElementById('modal-links-list');

        // Modal de Ciência
        const modalCienciaBackdrop = document.getElementById('modal-ciencia-backdrop');
        const modalCienciaContainer = document.getElementById('modal-ciencia-container');
        const modalCienciaPanel = document.getElementById('modal-ciencia-panel');
        const modalCienciaTitle = document.getElementById('modal-ciencia-title');
        const modalCienciaBody = document.getElementById('modal-ciencia-body');
        const cienciaLoadingSpinner = document.getElementById('ciencia-loading-spinner');
        const modalCienciaContent = document.getElementById('modal-ciencia-content');
        const cienciaPrevBtn = document.getElementById('ciencia-prev-btn');
        const cienciaNextBtn = document.getElementById('ciencia-next-btn');
        const cienciaCounter = document.getElementById('ciencia-counter');
        const declararCienciaBtn = document.getElementById('declarar-ciencia-btn');
        const cienciaStatus = document.getElementById('ciencia-status');


        // --- ESTADO GLOBAL ---
        let allCategories = [];
        let currentArticles = [];
        let currentUser = null;
        let currentUserRole = 'Leitor';
        let currentCategory = 'TODOS';
        let currentArticleCount = 0;
        const ARTICLES_PER_PAGE = 10;
        let isLoadingMore = false;
        let isSearchActive = false;
        let artigosParaCiencia = [];
        let cienciaArtigoIndex = 0;

        // --- FUNÇÃO WRAPPER DE FETCH (COM TOKEN) ---
        // (Atualizada para a API Monolito)
        async function fetchWithToken(action, payload = {}) {
            if (!currentUser) {
                throw new Error("Usuário não autenticado.");
            }
            try {
                const token = await getIdToken(currentUser, /* forceRefresh */ true);

                // Todas as chamadas agora vão para 'api' (que o vercel.json roteia para api/index.js)
                const response = await fetch('api', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action, payload }) // Envia a ação e o payload
                });

                const responseText = await response.text();
                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = JSON.parse(responseText);
                    } catch (e) {
                        console.error("Erro HTML/Texto (não-JSON) recebido:", responseText.substring(0, 100) + '...');
                        errorData = { error: `Erro ${response.status}: ${response.statusText || 'Erro no servidor'}` };
                    }
                    console.error(`Erro na API (ação: ${action}, status: ${response.status}):`, errorData.error);
                    if (response.status === 401) {
                        alert('Sua sessão expirou. Por favor, faça login novamente.');
                        await signOut(auth);
                    }
                    throw new Error(errorData.error || 'Erro na requisição');
                }
                if (response.status === 204) {
                    return null;
                }
                try {
                    return JSON.parse(responseText);
                } catch (e) {
                    return responseText;
                }
            } catch (error) {
                console.error("Erro fatal no fetchWithToken:", error);
                // Não joga o erro se for de auth/network, para não quebrar a UI
                if (!error.message.includes('Token') && !error.message.includes('NetworkError')) {
                    throw error;
                }
            }
        }


        // --- AUTENTICAÇÃO (COM SISTEMA DE CARGOS) ---
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                try {
                    // Chama a API upsert para registrar o usuário e obter seu cargo
                    // AÇÃO ATUALIZADA
                    const { role, email } = await fetchWithToken('user/upsert');
                    currentUserRole = role;

                    // Usuário está logado
                    loginSection.style.display = 'none';
                    // NÃO mostra o conteúdo ainda, espera a verificação de ciência
                    // contentSection.style.display = 'block'; 

                    // Mostra info do usuário
                    userInfo.classList.remove('hidden');
                    userEmailSpan.textContent = email;
                    userRoleSpan.textContent = role;

                    if (role === 'Redator' || role === 'Editor' || role === 'Admin') {
                        adminBtn.classList.remove('hidden');
                    } else {
                        adminBtn.classList.add('hidden');
                    }

                    // Verifica artigos de ciência ANTES de carregar o resto
                    await verificarArtigosParaCiencia();

                    // Carrega o conteúdo principal (só se o modal de ciência não estiver aberto)
                    if (artigosParaCiencia.length === 0) {
                        contentSection.style.display = 'block'; // Mostra o conteúdo
                        checkAndRenderAll();
                    }

                } catch (error) {
                    console.error("Erro ao verificar cargo do usuário:", error);
                    loginStatus.textContent = 'Erro ao verificar permissões. Tente novamente.';
                }
            } else {
                // Usuário está deslogado
                loginSection.style.display = 'flex';
                contentSection.style.display = 'none';
                adminBtn.classList.add('hidden');
                userInfo.classList.add('hidden');
                resetContent();
            }
        });

        // Logins (Google e Microsoft)
        googleLoginBtn.addEventListener('click', () => {
            loginStatus.textContent = 'Abrindo popup do Google...';
            signInWithPopup(auth, googleProvider).catch(handleAuthError);
        });

        function handleAuthError(error) {
            console.error("Erro de login:", error.code, error.message);
            if (error.code === 'auth/popup-closed-by-user') {
                loginStatus.textContent = 'Popup de login fechado.';
            } else if (error.code === 'auth/unauthorized-domain') {
                loginStatus.textContent = 'Erro: Domínio não autorizado.';
                alert("ERRO: O domínio do seu site não está autorizado. \n\nPor favor, vá ao Console do Firebase > Authentication > Settings > Authorized domains e adicione o domínio onde este site está hospedado.");
            } else {
                loginStatus.textContent = 'Erro ao tentar fazer login.';
            }
        }

        // Logout
        logoutBtn.addEventListener('click', () => {
            if (confirm('Tem certeza que deseja sair?')) {
                signOut(auth).catch((error) => {
                    console.error("Erro ao sair:", error);
                });
            }
        });

        // Limpa o conteúdo ao deslogar
        function resetContent() {
            allCategories = [];
            currentArticles = [];
            currentCategory = 'TODOS';
            currentArticleCount = 0;
            isSearchActive = false;
            categoryGrid.querySelectorAll('.category-card:not([data-category="TODOS"])').forEach(el => el.remove());
            const todosBtn = categoryGrid.querySelector('.category-card[data-category="TODOS"]');
            if (todosBtn) {
                todosBtn.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
            }
            articlesGrid.innerHTML = '';
            articlesStatus.textContent = 'Você precisa estar logado para ver o conteúdo.';
            articlesStatus.classList.remove('hidden');
            loadMoreContainer.classList.add('hidden');
            searchInput.value = '';
            searchField.value = 'all';
        }

        // --- CARREGAMENTO DE DADOS (VIA /api) ---

        async function checkAndRenderAll() {
            try {
                if (allCategories.length === 0) {
                    await loadCategories();
                }
                await executeSearchOrFilter();
            } catch (error) {
                console.error("Falha ao carregar dados iniciais:", error);
                articlesStatus.textContent = `Erro ao carregar dados: ${error.message}`;
                articlesStatus.classList.remove('hidden');
            }
        }

        // 1. Carregar Categorias
        async function loadCategories() {
            categoriesLoading.textContent = 'Carregando categorias...';
            categoriesLoading.classList.remove('hidden');
            try {
                // AÇÃO ATUALIZADA
                const categories = await fetchWithToken('getCategorias');
                allCategories = categories;
                renderCategories(categories);
                categoriesLoading.classList.add('hidden');
            } catch (error) {
                console.error("Erro ao buscar categorias:", error);
                categoriesLoading.textContent = 'Erro ao carregar.';
            }
        }

        // 2. Carregar Artigos (Paginação)
        loadMoreBtn.addEventListener('click', () => {
            if (!isLoadingMore && !isSearchActive) {
                loadMoreArticles();
            }
        });

        async function loadMoreArticles() {
            if (isLoadingMore) return;
            isLoadingMore = true;
            const limit = currentArticleCount + ARTICLES_PER_PAGE;
            loadMoreBtn.textContent = 'Carregando...';
            loadMoreBtn.disabled = true;

            try {
                // AÇÃO ATUALIZADA
                const payload = { limit: limit, category: currentCategory };
                const articles = await fetchWithToken('getArtigos', payload);

                const newArticles = articles.filter(a => !currentArticles.some(existing => existing.id === a.id));
                currentArticles = articles;
                currentArticleCount = articles.length;

                if (newArticles.length === 0 || articles.length < limit) {
                    loadMoreContainer.classList.add('hidden');
                } else {
                    loadMoreContainer.classList.remove('hidden');
                }
                renderArticles(newArticles, false); // false = não limpar o grid
            } catch (error) {
                console.error("Erro ao buscar mais artigos:", error);
                articlesStatus.textContent = `Erro ao carregar artigos: ${error.message}`;
                articlesStatus.classList.remove('hidden');
            } finally {
                isLoadingMore = false;
                loadMoreBtn.textContent = 'Carregar Mais 10 Artigos';
                loadMoreBtn.disabled = false;
            }
        }


        // --- RENDERIZAÇÃO (Interface) ---
        // (Ícones e Cores Atualizados)

        // Renderizar Categorias
        function renderCategories(categories) {
            categoryGrid.querySelectorAll('.category-card:not([data-category="TODOS"])').forEach(el => el.remove());
            categories.forEach(category => {
                const { name, color, icon } = category;
                const colors = getCategoryColors(color);
                const btn = document.createElement('button');
                btn.className = `category-card w-full flex items-center gap-3 p-3 rounded-lg text-left font-medium transition-colors duration-150 focus-ring-visible ${colors.bgHover} ${colors.text}`;
                btn.dataset.category = category.id;
                btn.innerHTML = `
                    <div class="w-8 h-8 flex-shrink-0 flex items-center justify-center rounded-lg ${colors.bg} ${colors.iconText}">
                        ${getIconSvg(icon)}
                    </div>
                    <span>${name}</span>
                `;
                categoryGrid.appendChild(btn);
            });
        }

        // Renderizar Artigos
        function renderArticles(articlesToRender, clearGrid = false) {
            if (clearGrid) {
                articlesGrid.innerHTML = '';
            }
            if (articlesToRender.length === 0 && clearGrid) {
                articlesStatus.textContent = 'Nenhum artigo encontrado para esta categoria ou busca.';
                articlesStatus.classList.remove('hidden');
                return;
            } else {
                articlesStatus.classList.add('hidden');
            }

            const fragment = document.createDocumentFragment();
            articlesToRender.forEach(article => {
                const { id, title, summary, categoryId } = article;
                const category = allCategories.find(c => c.id === categoryId);
                const colors = getCategoryColors(category ? category.color : 'slate');
                const categoryName = category ? category.name : 'Sem Categoria';
                const card = document.createElement('div');
                card.className = `article-card bg-white rounded-2xl shadow-lg overflow-hidden transition-transform transform hover:-translate-y-1 hover:shadow-xl cursor-pointer flex flex-col ${colors.border} border-t-4`;
                card.dataset.id = id;
                card.innerHTML = `
                    <div class="p-6 flex-grow">
                        <span class="text-sm font-semibold ${colors.text}">${categoryName.toUpperCase()}</span>
                        <h3 class="mt-2 text-xl font-bold text-slate-800">${title}</h3>
                        <p class="mt-3 text-base text-slate-600 line-clamp-3">${summary}</p>
                    </div>
                    <footer class="bg-slate-50 px-6 py-4">
                        <span class="text-sm font-medium text-blue-600 hover:text-blue-700">Ver artigo completo &rarr;</span>
                    </footer>
                `;
                fragment.appendChild(card);
            });
            articlesGrid.appendChild(fragment);
        }

        // --- LÓGICA DE BUSCA (NOVA ARQUITETURA) ---
        let searchTimeout;
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                executeSearchOrFilter();
            }, 300);
        });

        searchField.addEventListener('change', executeSearchOrFilter);

        categoryGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.category-card');
            if (card) {
                currentCategory = card.dataset.category;
                document.querySelectorAll('.category-card').forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                    const category = allCategories.find(c => c.id === btn.dataset.category);
                    const colors = getCategoryColors(category ? category.color : 'slate');
                    if (btn.dataset.category !== 'TODOS') {
                        btn.classList.add(colors.bgHover, colors.text);
                    }
                });
                card.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                const activeColors = getCategoryColors(allCategories.find(c => c.id === card.dataset.category)?.color);
                if (card.dataset.category !== 'TODOS') {
                    card.classList.remove(activeColors.bgHover, activeColors.text);
                }
                executeSearchOrFilter();
            }
        });

        async function executeSearchOrFilter() {
            const searchTerm = searchInput.value.trim();
            const searchScope = searchField.value;

            articlesGrid.innerHTML = '';
            articlesStatus.classList.remove('hidden');
            articlesStatus.innerHTML = `
                <svg class="mx-auto h-12 w-12 text-slate-400 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-4 text-lg font-medium">Carregando artigos...</p>`;

            if (searchTerm === '') {
                isSearchActive = false;
                articlesTitle.textContent = 'Artigos Recentes';
                currentArticles = [];
                currentArticleCount = 0;
                await loadMoreArticles();
            } else {
                isSearchActive = true;
                articlesTitle.textContent = `Resultados da Busca por: "${searchTerm}"`;
                loadMoreContainer.classList.add('hidden');
                try {
                    // AÇÃO ATUALIZADA
                    const payload = { term: searchTerm, scope: searchScope, category: currentCategory };
                    const searchResults = await fetchWithToken('searchArtigos', payload);

                    currentArticles = searchResults;
                    renderArticles(searchResults, true);
                } catch (error) {
                    console.error("Erro ao executar busca:", error);
                    articlesStatus.textContent = `Erro ao buscar: ${error.message}`;
                    articlesStatus.classList.remove('hidden');
                }
            }
        }

        // --- MODAL (Janela do Artigo) ---
        articlesGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.article-card');
            if (card) {
                const articleId = card.dataset.id;
                openModal(articleId);
            }
        });

        async function openModal(id) {
            modalTitle.textContent = 'Carregando Título...';
            modalContent.innerHTML = '';
            modalMetadata.classList.add('hidden');
            modalLinksContainer.classList.add('hidden');
            modalLinksList.innerHTML = '';
            modalLoadingSpinner.classList.remove('hidden');

            modalBackdrop.style.display = 'block';
            modalContainer.style.display = 'flex';
            setTimeout(() => {
                modalBackdrop.style.opacity = '1';
                modalPanel.style.opacity = '1';
                modalPanel.style.transform = 'scale(1)';
            }, 10);

            try {
                // AÇÃO ATUALIZADA
                const article = await fetchWithToken('getArtigoDetalhe', { id: id });

                modalTitle.textContent = article.title;

                const category = allCategories.find(c => c.id === article.categoryId);
                if (category) {
                    const colors = getCategoryColors(category.color);
                    modalCategoryBadge.innerHTML = `
                        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold ${colors.bg} ${colors.iconText}">
                            ${getIconSvg(category.icon)}
                            ${category.name}
                        </span>`;
                } else {
                    modalCategoryBadge.innerHTML = '';
                }

                if (article.publishedAt) {
                    const date = new Date(article.publishedAt.seconds * 1000).toLocaleDateString('pt-BR', {
                        day: '2-digit', month: 'long', year: 'numeric'
                    });
                    modalDate.textContent = date;
                } else {
                    modalDate.textContent = '--';
                }

                modalSummary.textContent = article.summary;

                if (article.tags && article.tags.length > 0) {
                    modalTagsList.innerHTML = article.tags.map(tag =>
                        `<span class="inline-block bg-slate-200 text-slate-700 px-2 py-0.5 rounded-md">${tag}</span>`
                    ).join(' ');
                    modalTagsContainer.classList.remove('hidden');
                } else {
                    modalTagsContainer.classList.add('hidden');
                }

                modalContent.innerHTML = article.content;

                if (article.links && article.links.length > 0) {
                    modalLinksList.innerHTML = ''; // Limpa
                    article.links.forEach(link => {
                        if (!link) return;
                        const li = document.createElement('li');
                        try {
                            const url = new URL(link);
                            li.innerHTML = `<a href="${link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-700 hover:underline break-all">${url.hostname}</a>`;
                        } catch (e) {
                            li.innerHTML = `<a href="${link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-700 hover:underline break-all">${link}</a>`;
                        }
                        modalLinksList.appendChild(li);
                    });
                    modalLinksContainer.classList.remove('hidden');
                }

                modalMetadata.classList.remove('hidden');
                modalLoadingSpinner.classList.add('hidden');

            } catch (error) {
                console.error("Erro ao abrir modal (fetchWithToken):", error);
                modalTitle.textContent = 'Erro ao Carregar';
                modalContent.innerHTML = `<p class="text-red-500">${error.message || 'Não foi possível carregar o conteúdo deste artigo. Tente novamente mais tarde.'}</p>`;
                modalLoadingSpinner.classList.add('hidden');
            }
        }
        function closeModal() {
            modalPanel.style.transform = 'scale(0.95)';
            modalPanel.style.opacity = '0';
            modalBackdrop.style.opacity = '0';
            setTimeout(() => {
                modalBackdrop.style.display = 'none';
                modalContainer.style.display = 'none';
            }, 300);
        }
        modalCloseBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);


        // --- NOVO: LÓGICA DO MODAL DE CIÊNCIA ---

        async function verificarArtigosParaCiencia() {
            try {
                // AÇÃO ATUALIZADA
                const artigos = await fetchWithToken('getArtigosParaCiencia');

                if (artigos && artigos.length > 0) {
                    artigosParaCiencia = artigos;
                    cienciaArtigoIndex = 0;
                    abrirModalCiencia();
                } else {
                    // Nenhum artigo pendente, carrega o site normalmente
                    contentSection.style.display = 'block'; // Mostra o conteúdo
                    checkAndRenderAll();
                }
            } catch (error) {
                console.error("Erro ao verificar artigos para ciência:", error);
                // Falha ao verificar, carrega o site normalmente para não bloquear o usuário
                contentSection.style.display = 'block'; // Mostra o conteúdo
                checkAndRenderAll();
            }
        }

        function abrirModalCiencia() {
            modalCienciaBackdrop.style.display = 'block';
            modalCienciaContainer.style.display = 'block';
            setTimeout(() => {
                modalCienciaBackdrop.style.opacity = '1';
                modalCienciaPanel.style.opacity = '1';
                modalCienciaPanel.style.transform = 'scale(1)';
            }, 10);
            renderArtigoCiencia();
        }

        async function renderArtigoCiencia() {
            // Mostra o spinner e esconde o conteúdo
            cienciaLoadingSpinner.style.display = 'block';
            modalCienciaContent.style.display = 'none';
            declararCienciaBtn.style.display = 'none';
            cienciaNextBtn.style.display = 'none';
            cienciaPrevBtn.style.display = 'none';
            cienciaStatus.textContent = '';

            const artigo = artigosParaCiencia[cienciaArtigoIndex];
            if (!artigo) return;

            try {
                // AÇÃO ATUALIZADA
                const artigoCompleto = await fetchWithToken('getArtigoDetalhe', { id: artigo.id });

                modalCienciaTitle.textContent = artigoCompleto.title;
                modalCienciaContent.innerHTML = artigoCompleto.content;

                cienciaLoadingSpinner.style.display = 'none';
                modalCienciaContent.style.display = 'block';

                // Atualiza a navegação
                cienciaCounter.textContent = `Artigo ${cienciaArtigoIndex + 1} de ${artigosParaCiencia.length}`;

                if (cienciaArtigoIndex > 0) {
                    cienciaPrevBtn.style.display = 'inline-flex';
                }
                if (cienciaArtigoIndex < artigosParaCiencia.length - 1) {
                    cienciaNextBtn.style.display = 'inline-flex';
                } else {
                    // É o último artigo
                    declararCienciaBtn.style.display = 'inline-flex';
                }
            } catch (error) {
                console.error("Erro ao carregar detalhe do artigo de ciência:", error);
                modalCienciaTitle.textContent = 'Erro ao Carregar Artigo';
                modalCienciaContent.innerHTML = `<p class="text-red-500">${error.message}</p>`;
                cienciaLoadingSpinner.style.display = 'none';
                modalCienciaContent.style.display = 'block';
            }
        }

        cienciaPrevBtn.addEventListener('click', () => {
            if (cienciaArtigoIndex > 0) {
                cienciaArtigoIndex--;
                renderArtigoCiencia();
            }
        });

        cienciaNextBtn.addEventListener('click', () => {
            if (cienciaArtigoIndex < artigosParaCiencia.length - 1) {
                cienciaArtigoIndex++;
                renderArtigoCiencia();
            }
        });

        declararCienciaBtn.addEventListener('click', async () => {
            declararCienciaBtn.disabled = true;
            declararCienciaBtn.textContent = 'Registrando...';
            cienciaStatus.textContent = '';

            try {
                const artigosConcluidos = artigosParaCiencia.map(art => ({
                    articleId: art.id,
                    scienceVersion: art.scienceVersion
                }));

                // AÇÃO ATUALIZADA
                await fetchWithToken('user/declararCiencia', { artigos: artigosConcluidos });

                // Sucesso! Fecha o modal e carrega o site.
                fecharModalCiencia();
                contentSection.style.display = 'block'; // Mostra o conteúdo principal
                checkAndRenderAll(); // Carrega o conteúdo principal

            } catch (error) {
                console.error("Erro ao declarar ciência:", error);
                cienciaStatus.textContent = `Erro: ${error.message}`;
                declararCienciaBtn.disabled = false;
                declararCienciaBtn.innerHTML = `
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                       <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Declarar Ciência
                `;
            }
        });

        function fecharModalCiencia() {
            modalCienciaPanel.style.transform = 'scale(0.95)';
            modalCienciaPanel.style.opacity = '0';
            modalCienciaBackdrop.style.opacity = '0';
            setTimeout(() => {
                modalCienciaBackdrop.style.display = 'none';
                modalCienciaContainer.style.display = 'none';
            }, 300);
        }

        // --- FUNÇÕES UTILITÁRIAS ---
        // (Ícones e Cores ATUALIZADOS)

        function getIconSvg(iconName) {
            switch (iconName) {
                case 'book':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25"></path></svg>';
                case 'bolt':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>';
                case 'gavel':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                case 'alert':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
                case 'info':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                case 'user': // ÍCONE ATUALIZADO
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"></path></svg>';
                case 'list':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>';
                case 'file':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>';
                case 'chart-bar':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>';
                case 'chat-alt':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>';
                case 'cog':
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>';
                default:
                    return '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>';
            }
        }

        // Retorna as classes de cor do Tailwind
        function getCategoryColors(colorName) {
            switch (colorName) {
                case 'red': return { text: 'text-red-700', bg: 'bg-red-100', iconText: 'text-red-600', bgHover: 'hover:bg-red-50', border: 'border-red-500' };
                case 'orange': return { text: 'text-orange-700', bg: 'bg-orange-100', iconText: 'text-orange-600', bgHover: 'hover:bg-orange-50', border: 'border-orange-500' };
                case 'yellow': return { text: 'text-yellow-700', bg: 'bg-yellow-100', iconText: 'text-yellow-600', bgHover: 'hover:bg-yellow-50', border: 'border-yellow-500' };
                case 'green': return { text: 'text-green-700', bg: 'bg-green-100', iconText: 'text-green-600', bgHover: 'hover:bg-green-50', border: 'border-green-500' };
                case 'blue': return { text: 'text-blue-700', bg: 'bg-blue-100', iconText: 'text-blue-600', bgHover: 'hover:bg-blue-50', border: 'border-blue-500' };
                case 'indigo': return { text: 'text-indigo-700', bg: 'bg-indigo-100', iconText: 'text-indigo-600', bgHover: 'hover:bg-indigo-50', border: 'border-indigo-500' };
                case 'purple': return { text: 'text-purple-700', bg: 'bg-purple-100', iconText: 'text-purple-600', bgHover: 'hover:bg-purple-50', border: 'border-purple-500' };
                case 'pink': return { text: 'text-pink-700', bg: 'bg-pink-100', iconText: 'text-pink-600', bgHover: 'hover:bg-pink-50', border: 'border-pink-500' };
                // NOVAS CORES
                case 'cyan': return { text: 'text-cyan-700', bg: 'bg-cyan-100', iconText: 'text-cyan-600', bgHover: 'hover:bg-cyan-50', border: 'border-cyan-500' };
                case 'teal': return { text: 'text-teal-700', bg: 'bg-teal-100', iconText: 'text-teal-600', bgHover: 'hover:bg-teal-50', border: 'border-teal-500' };
                case 'lime': return { text: 'text-lime-700', bg: 'bg-lime-100', iconText: 'text-lime-600', bgHover: 'hover:bg-lime-50', border: 'border-lime-500' };
                case 'fuchsia': return { text: 'text-fuchsia-700', bg: 'bg-fuchsia-100', iconText: 'text-fuchsia-600', bgHover: 'hover:bg-fuchsia-50', border: 'border-fuchsia-500' };
                case 'sky': return { text: 'text-sky-700', bg: 'bg-sky-100', iconText: 'text-sky-600', bgHover: 'hover:bg-sky-50', border: 'border-sky-500' };
                case 'slate':
                default:
                    return { text: 'text-slate-700', bg: 'bg-slate-200', iconText: 'text-slate-600', bgHover: 'hover:bg-slate-100', border: 'border-slate-400' };
            }
        }

    </script>
</body>

</html>