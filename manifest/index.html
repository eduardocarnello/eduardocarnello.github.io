<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Manifestação em PDF</title>

    <style>
        @media print {
            body {
                font-size: 12pt;
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
            }
            h1 {
                font-size: 16pt;
                text-align: center;
            }
            label {
                font-weight: bold;
            }
            #manifestacaoText {
                white-space: pre-line;
            }
        }
    </style>
</head>
<body>
    <h1>Manifestação em Juizado Especial Cível</h1>
    <form id="manifestForm">
        <label for="processo">Processo nº:</label>
        <input type="text" id="processo" required><br><br>
        
        <label for="nome">Nome da parte:</label>
        <input type="text" id="nome" required><br><br>
        
        <label for="rg">RG da parte:</label>
        <input type="text" id="rg" required><br><br>
        
        <label for="cpf">CPF da parte:</label>
        <input type="text" id="cpf" required><br><br>
        
        <label for="atualizarEndereco">Atualizar endereço:</label>
        <select id="atualizarEndereco">
            <option value="nao">Não</option>
            <option value="sim">Sim</option>
        </select><br><br>
        
        <div id="enderecoFields" style="display:none;">
            <label for="endereco">Novo endereço:</label>
            <textarea id="endereco" rows="3" cols="40"></textarea><br><br>
        </div>
        
        <label for="manifestacao">Manifestação:</label><br>
        <textarea id="manifestacao" rows="6" cols="50" required></textarea><br><br>
        
        <button type="button" onclick="gerarPDF()">Gerar Manifestação</button>

        <script src="https://cdn.jsdelivr.net/npm/pdf-lib@^1.15.0/dist/pdf-lib.min.js"></script>
        <script>
            async function gerarPDF() {
                const processo = document.getElementById('processo').value;
                const nome = document.getElementById('nome').value;
                const rg = document.getElementById('rg').value;
                const cpf = document.getElementById('cpf').value;
                const atualizarEndereco = document.getElementById('atualizarEndereco').value;
                const endereco = document.getElementById('endereco').value;
                const manifestacao = document.getElementById('manifestacao').value;

                const manifestacaoText = `
                    EXCELENTÍSSIMO JUIZ DE DIREITO DO JUIZADO ESPECIAL CÍVEL DE MARÍLIA/SP

                    Processo nº: ${processo}

                    ${nome}, portador(a) do RG ${rg} e CPF ${cpf}${atualizarEndereco === 'sim' ? `, residente no seguinte endereço: ${endereco}` : ''},
                    já devidamente qualificado(a), nos autos da ação em epígrafe, vem, respeitosamente, apresentar manifestação nos seguintes termos:

                    ${manifestacao}

                    Termos em que pede deferimento

                    Marília/SP, ${new Date().toLocaleDateString('pt-BR')}
                    
                    _________________________
                    ${nome}
                `;

                const pdfDoc = await PDFLib.PDFDocument.create();
                const page = pdfDoc.addPage();
                const { width, height } = page.getSize();

                const textWidth = 500;
                const textHeight = height - 50;
                const fontSize = 12;

                const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
                page.drawText(manifestacaoText, {
                    x: 50,
                    y: textHeight,
                    font,
                    fontSize,
                    maxWidth: textWidth,
                    lineHeight: fontSize * 1.2,
                    color: PDFLib.rgb(0, 0, 0),
                });

                const pdfBytes = await pdfDoc.save();

                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);

                const newTab = window.open(url, '_blank');
                if (!newTab) {
                    alert('Erro ao abrir o PDF. Verifique as configurações do seu navegador.');
                }
            }

            document.getElementById('atualizarEndereco').addEventListener('change', function() {
                const display = this.value === 'sim' ? 'block' : 'none';
                document.getElementById('enderecoFields').style.display = display;
            });
        </script>
    </form>
</body>
</html>
